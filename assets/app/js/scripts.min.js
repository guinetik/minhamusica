"use strict";function MainCtrl($scope,$rootScope,api,$timeout){$scope.home={},$scope.bannersLoaded=!1,$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateHome)}),$scope.updateHome=function(){api.getHome(function(result){200==result.status?($scope.home=result.home,angular.forEach($scope.home.banners,function(banner){banner.mimeType="image/png",banner.src="/public/img/"+banner.src}),$timeout(function(){$scope.bannersLoaded=!0,$scope.slickHandle.slickGoTo(0)},500)):window.location.reload()})},$scope.slickHandle={currentSlide:0},$scope.slickConfig={dots:!1,autoplay:!0,slidesToShow:1,centerMode:!0,arrows:!0,variableWidth:!0,adaptiveHeight:!1,autoplaySpeed:3e3,lazyLoad:"progressive",onAfterChange:function(slide,index){console.log("index",index),$scope.slickHandle.currentSlide=index,$scope.$apply()}}}function SignUpCtrl($scope,api,toastr,$timeout){$scope.usuario={nome:"",email:"",senha:"",sexo:"m",estadoSelecionado:null,cidadeSelecionada:null,usuarioAceitou:!0,nascimento:new Date,twitter:"",instagram:""},$scope.origem=angular.copy($scope.usuario),$scope.estados=[],$scope.tipos=[],$scope.$on("$viewContentLoaded",function(){$timeout(function(){api.getEstados(function(result){console.log("result",result),$scope.estados=result})})}),$scope.submit=function(){var user={nome:$scope.usuario.nome,email:$scope.usuario.email,senha:$scope.usuario.senha,sexo:$scope.usuario.sexo,nascimento:$scope.usuario.nascimento,cidade:$scope.usuario.cidadeSelecionada.id,twitter:$scope.usuario.twitter,instagram:$scope.usuario.instagram};api.signup(user,function(result){200==result.status?toastr.success(result.message):toastr.warning(result.message)})},$scope.reset=function(){$scope.usuario=angular.copy($scope.origem)}}function LoginCtrl($scope,api,toastr){$scope.usuario={email:"",senha:""},$scope.origem=angular.copy($scope.usuario),$scope.submit=function(){api.login($scope.usuario,function(result){200==result.status?toastr.success(result.message):toastr.warning(result.message?result.message.message:"Ocorreu um erro, tente novamente.")})},$scope.reset=function(){$scope.usuario=angular.copy($scope.origem)}}function HeaderCtrl($scope,$rootScope,auth,api,$state){if($scope.isAuthenticated=auth.isAuthenticated(),$scope.generos=[],$scope.user=null,$scope.isAuthenticated){var token=auth.getToken();auth.getUser(token)}$scope.logout=function(){auth.logout(),$scope.isAuthenticated=!1,$state.go("main")},$rootScope.$on("user-lookup",function(event,user){console.log("user-lookup",user),$scope.user=user}),$rootScope.$on("update-user-token",function(event,token){if(auth.setToken(token),$scope.isAuthenticated=auth.isAuthenticated(),$scope.isAuthenticated||$state.go("main"),"-1"!=token){{auth.getUser(token)}$state.go("main")}}),api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos)}),$scope.searchCD=function(){$state.go("busca",{q:$scope.query})}}function CdCtrl($scope,api,$timeout,$stateParams,$rootScope,toastr){$scope.cd={},$scope.cd.id=$stateParams.id,$scope.$on("$viewContentLoaded",function(){$timeout(function(){api.getCD($scope.cd.id,function(result){200==result.status&&($scope.cd=result)})})}),$scope.downloadCD=function(){api.downloadCD($scope.cd.id,function(result){console.log("downloadCD",result),200==result.status?toastr.info(result.message):toastr.warning(result.message?result.message:"Houve um erro. tente novamente")})},$scope.addToPlaylist=function(musica){musica.cd=$scope.cd,$rootScope.$emit("add-to-playlist",musica)},$scope.addAll=function(){$rootScope.$emit("add-cd-to-playlist",$scope.cd)},$scope.shareSong=function(){alert("SHARE")},$scope.downloadSong=function(){alert("DOWNLOAD")}}function GeneroCtrl($scope,api,toastr,$timeout,$stateParams){$scope.cds=[],$scope.genero="",$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateGeneros)}),$scope.updateGeneros=function(){var id=$stateParams.id;api.getCdsByGenero(id,function(result){200==result.status&&($scope.genero=result.genero,$scope.cds=result.cds)})}}function BuscaCtrl($scope,api,toastr,$timeout,$stateParams){$scope.cds=[],$scope.$on("$viewContentLoaded",function(){$timeout($scope.searchCD)}),$scope.searchCD=function(){var q=$stateParams.q;api.searchCD(q,function(result){200==result.status&&($scope.cds=result.cds)})}}function api(ws,$upload,API_URL){var api=this;api.getEstados=function(cb){ws.consumeService("data/estados",null,null,cb,!1,"GET")},api.getHome=function(cb){ws.consumeService("data/home",null,null,cb,!1,"GET")},api.getGeneros=function(cb){ws.consumeService("data/generos",null,null,cb,!1,"GET")},api.signup=function(user,cb){ws.consumeService("usuarios/create",user,null,cb,!1)},api.login=function(user,cb){ws.consumeService("user/login",user,null,cb,!1)},api.lookup=function(token,cb){ws.consumeService("usuarios/lookup",null,token,cb,!1)},api.addCd=function(token,cd,cb){ws.consumeService("cd/add",cd,token,cb,!1)},api.addMusic=function(musica,cb){$upload.upload({url:API_URL+"cd/music/add",method:"POST",data:{id_cd:musica.cd},file:musica.file}).progress(function(evt){musica.progress=parseInt(100*evt.loaded/evt.total),musica.status=1,musica.message="Enviando: "+musica.progress+"%"}).success(function(data,status,headers,config){200==status?(musica.status=2,musica.message="Enviada",musica.cd=data.musica.cd,musica.id=data.musica.id,musica.nome=data.musica.nome,musica.filename=data.musica.filename,delete musica.file):(musica.status=-1,musica.message="Erro ao enviar"),cb(data,status,headers,config)})},api.deleteMusic=function(music,token,cb){ws.consumeService("musica/destroy/"+music.id,null,token,cb,!1,"GET")},api.deleteCd=function(cd,token,cb){ws.consumeService("cd/destroy/"+cd.id,null,token,cb,!1,"GET")},api.updateMusic=function(music,token,cb){var m={id:music.id,cd:music.cd,nome:music.nome};ws.consumeService("musica/update/"+music.id,m,token,cb,!1)},api.updateTrack=function(music,token,cb){var m={id:music.id,track:music.track};ws.consumeService("musica/update/track",m,token,cb,!1)},api.updateCover=function(file,capa,token,cb){var data={};capa.cd&&(data.id=capa.cd),$upload.upload({url:API_URL+"cd/cover/update",method:"POST",data:data,file:file}).progress(function(evt){capa.progress=parseInt(100*evt.loaded/evt.total),capa.status=1,capa.message="Enviando: "+capa.progress+"%"}).success(function(data,status,headers,config){200==status?(capa.status=2,capa.message="Enviada",capa.imagem=data.imagem):(capa.status=-1,capa.message="Erro ao enviar"),cb(data,status,headers,config)})},api.updateUserCover=function(file,capa,token,cb){var data={};capa.user&&(data.id=capa.user),$upload.upload({url:API_URL+"user/cover/update",method:"POST",data:data,file:file}).progress(function(evt){capa.progress=parseInt(100*evt.loaded/evt.total),capa.status=1,capa.message="Enviando: "+capa.progress+"%"}).success(function(data,status,headers,config){200==status?(capa.status=2,capa.message="Enviada",capa.imagem=data.imagem):(capa.status=-1,capa.message="Erro ao enviar"),cb(data,status,headers,config)})},api.updateUserFoto=function(file,foto,token,cb){var data={};foto.user&&(data.id=foto.user),$upload.upload({url:API_URL+"user/foto/update",method:"POST",data:data,file:file}).progress(function(evt){foto.progress=parseInt(100*evt.loaded/evt.total),foto.status=1,foto.message="Enviando: "+foto.progress+"%"}).success(function(data,status,headers,config){200==status?(foto.status=2,foto.message="Enviada",foto.imagem=data.imagem):(foto.status=-1,foto.message="Erro ao enviar"),cb(data,status,headers,config)})},api.getUserCollection=function(token,cb){ws.consumeService("usuarios/collection",null,token,cb,!1,"GET")},api.getProfile=function(id,cb){ws.consumeService("usuarios/perfil?id="+id,null,null,cb,!1,"GET")},api.getCD=function(id,cb){ws.consumeService("cd/"+id,null,null,cb,!1,"GET")},api.updateProfile=function(user,token,cb){var u={id:user.id,nome:user.nome,email:user.email,sexo:user.sexo,cidade:user.cidade,twitter:user.twitter,facebook:user.facebook,instagram:user.instagram,nascimento:user.nascimento};ws.consumeService("usuarios/"+user.id,u,token,cb,!1)},api.updateCD=function(cd,token,cb){var c={id:cd.id,titulo:cd.titulo,descricao:cd.descricao,"private":cd["private"],capa:cd.capa,genero:cd.genero};ws.consumeService("cd/update/"+cd.id,c,token,cb,!1)},api.updatePassword=function(user,token,cb){ws.consumeService("user/password/update",user,token,cb,!1)},api.downloadCD=function(id,cb){ws.consumeService("cd/download/",{id:id},null,cb,!1,"POST")},api.getCdsByGenero=function(id,cb){ws.consumeService("cd/genero?id="+id,null,null,cb,!1,"GET")},api.searchCD=function(q,cb){ws.consumeService("cd/search?q="+q,null,null,cb,!1,"GET")}}function ws($rootScope,$http,API_URL){var ws=this,m="POST";ws.baseURL=API_URL,ws.consumeService=function(endpoint,params,token,cb,overrideBase,method){var serviceURL,headers={"content-type":"application/json"};params||(params={}),method||(method=m),token&&(headers.token=token),serviceURL=overrideBase?endpoint:ws.baseURL+endpoint,$http({url:serviceURL,method:method,data:params,headers:headers}).success(function(result,status){result.status=status,200==status&&result.token&&$rootScope.$emit("update-user-token",result.token),cb&&cb(result)}).error(function(err,status){console.log("errror"),cb({message:err,status:status})})}}function PainelCtrl($scope){$scope.$on("$viewContentLoaded",function(){console.log("PainelCtrl:viewContentLoaded")})}function NovoCDCtrl($scope,cd){$scope.cd={musicas:[]},$scope.generos=[],$scope.files=[],$scope.capas=[],$scope.capa={},cd.scope=$scope,$scope.sortOptions=cd.sortOptions,$scope.view="basic",$scope.title="NOVO CD",$scope.toggleState=function(view){$scope.cd.saved&&($scope.view=view)},$scope.$on("$viewContentLoaded",function(){cd.getGeneros($scope)}),$scope.generateThumb=function(file){cd.generateThumb($scope,file)},$scope.updateCover=function(file){cd.updateCover($scope,file)},$scope.fileDropped=function($files,$event,$rejectedFiles){cd.fileDropped($scope,$files,$event,$rejectedFiles)},$scope.deleteMusic=function(musica){cd.deleteMusic($scope,musica)},$scope.submit=function(){console.log("cd",$scope.cd),cd.create($scope)},$scope.salvarCd=function(){cd.salvarCd($scope)},$scope.updateMusic=function(music){cd.updateMusic($scope,music)},$scope.addToPlaylist=function(song){cd.addToPlaylist($scope,song)}}function MeusCDsCtrl($scope,api,auth,toastr,$timeout){$scope.cds=[];var token=auth.getToken();$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateCollection)}),$scope.updateCollection=function(){api.getUserCollection(token,function(result){200==result.status&&($scope.cds=result.cds)})},$scope.deleteCd=function(cd){api.deleteCd(cd,token,function(result){200==result.status?(toastr.info("CD Excluído"),$scope.updateCollection()):toastr.warning("Houve um erro ao excluir o cd")})}}function NovoEventoCtrl($scope){$scope.$on("$viewContentLoaded",function(){console.log("NovoEventoCtrl:viewContentLoaded")})}function MeusEventosCtrl($scope){$scope.$on("$viewContentLoaded",function(){console.log("MeusEventosCtrl:viewContentLoaded")})}function ConfigsCtrl($rootScope,$scope,api,auth,$timeout,$state,toastr,$upload){$scope.usuario={},$scope.capa={},$scope.foto={},$scope.estados=[],console.log($upload),$scope.$on("$viewContentLoaded",function(){$timeout(function(){api.getEstados(function(result){$scope.estados=result;var token=auth.getToken();api.lookup(token,function(result){200==result.status?($scope.usuario=result.data,$scope.capa.dataUrl=$scope.capa.imagem="/public/img/"+$scope.usuario.capa,$scope.foto.dataUrl=$scope.foto.imagem="/public/img/"+$scope.usuario.foto,$scope.selectEstado($scope.usuario.cidade.estado),$scope.usuario.nascimento=new Date($scope.usuario.nascimento),$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")})})})}),$scope.selectEstado=function(id){angular.forEach($scope.estados,function(value){value.id==id&&($scope.estado=value)})},$scope.submit=function(){var token=auth.getToken();api.updateProfile($scope.usuario,token,function(result){200==result.status?($rootScope.$emit("user-lookup",result),toastr.success("Perfil atualizado")):toastr.error("Houve um erro ao atualizar o perfil.")})},$scope.generateCoverThumb=function(file){null!=file&&(console.log("capa nova",file),file.type.indexOf("image")>-1&&($scope.updateUserCover(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){console.log("capa nova",e.target.result),$scope.capa.dataUrl=e.target.result})}})))},$scope.updateUserCover=function(file){null!=$scope.usuario.id&&($scope.capa.user=$scope.usuario.id);var token=auth.getToken();api.updateUserCover(file,$scope.capa,token,function(data,status){200==status?(toastr.info(data.message),$scope.usuario.capa=data.imagem,$rootScope.$emit("user-lookup",$scope.usuario)):toastr.warning(data.message)})},$scope.updateUserFoto=function(file){console.log("updateFoto"),null!=$scope.usuario.id&&($scope.foto.user=$scope.usuario.id);var token=auth.getToken();api.updateUserFoto(file,$scope.foto,token,function(data,status){200==status?(toastr.info(data.message),$scope.usuario.foto=data.imagem,$rootScope.$emit("user-lookup",$scope.usuario)):toastr.warning(data.message)})},$scope.generateThumb=function(file){console.log("foto nova",file),null!=file&&file.type.indexOf("image")>-1&&($scope.updateUserFoto(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){$scope.foto.dataUrl=e.target.result,console.log("foto nova",e.target.result)})}}))}}function ConfigPasswordCtrl($scope,api,auth,toastr,$state){$scope.usuario={},$scope.submit=function(){var token=auth.getToken();api.updatePassword($scope.usuario,token,function(result){200==result.status?(toastr.info(result.message),$state.go("main")):toastr.warning(result.message)})}}function PerfilCtrl($scope,api,$stateParams,$timeout){$scope.perfil={},$scope.id=$stateParams.id,$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateProfile)}),$scope.updateProfile=function(){console.log("updateProfile",$scope.id),api.getProfile($scope.id,function(result){console.log("updateProfile",result),200==result.status&&($scope.perfil=result.perfil)})}}function EditCDCtrl($scope,cd,$stateParams){$scope.cd={},$scope.musicas=[],$scope.generos=[],$scope.capas=[],$scope.capa={},$scope.view="basic",cd.scope=$scope,$scope.sortOptions=cd.sortOptions,$scope.cd.id=$stateParams.id,$scope.title="EDITAR CD",$scope.toggleState=function(view){$scope.cd.saved&&($scope.view=view)},$scope.generateThumb=function(file){cd.generateThumb($scope,file)},$scope.updateCover=function(file){cd.updateCover($scope,file)},$scope.fileDropped=function($files,$event,$rejectedFiles){cd.fileDropped($scope,$files,$event,$rejectedFiles)},$scope.deleteMusic=function(musica){cd.deleteMusic($scope,musica)},$scope.submit=function(){cd.update($scope)},$scope.salvarCd=function(){cd.salvarCd($scope)},$scope.updateMusic=function(music){cd.updateMusic($scope,music)},$scope.$on("$viewContentLoaded",function(){cd.getCd($scope)}),$scope.addToPlaylist=function(song){cd.addToPlaylist($scope,song)}}function cd($timeout,toastr,api,auth,$state,$rootScope){var cd=this;cd.getGeneros=function($scope){$timeout(function(){api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos)})})},cd.sortOptions={ghostClass:"drop-ghost",animation:150,onUpdate:function(event,a){var token=auth.getToken();angular.forEach(cd.scope.cd.musicas,function(musica){angular.forEach(a,function(musicaa,key){if(musica.id==musicaa.id){var track=key+1;musica.track!=track&&(musica.track=key+1,api.updateTrack(musica,token,function(result){console.log("UpdateTrack",result)}))}})})}},cd.addToPlaylist=function($scope,musica){var song=angular.copy(musica),_cd=angular.copy($scope.cd);delete _cd.musicas,song.cd=_cd,$rootScope.$emit("add-to-playlist",song)},cd.getCd=function($scope){$timeout(function(){api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos,api.getCD($scope.cd.id,function(result){200==result.status&&($scope.cd=result,$scope.cd.saved=!0,$scope.musicas&&($scope.musicas=$scope.cd.musicas),$scope.capa.dataUrl=$scope.capa.imagem="/public/img/"+$scope.cd.capa,cd.setMusicStatus($scope))}))})})},cd.setMusicStatus=function($scope){var musicas=$scope.cd.musicas;angular.forEach(musicas,function(value){value.status=2,value.message="Enviada"})},cd.salvarCd=function($scope){toastr.info("Cd Criado com sucesso!"),$state.go("cd",{id:$scope.cd.id})},cd.generateThumb=function($scope,file){null!=file&&file.type.indexOf("image")>-1&&($scope.updateCover(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){$scope.capa.dataUrl=e.target.result})}}))},cd.updateCover=function($scope,file){null!=$scope.cd.id&&($scope.capa.cd=$scope.cd.id);var token=auth.getToken();api.updateCover(file,$scope.capa,token,function(data,status){200==status?(toastr.info(data.message),$scope.cd.capa=data.imagem):toastr.warning(data.message)})},cd.fileDropped=function($scope,$files){for(var i=0;i<$files.length;i++){var filename=$files[i].name;if("mp3"==filename.substr(filename.length-3,3)){var file=$files[i],music={};music.file=file,music.status=0,music.cd=$scope.cd.id,music.nome=file.name,music.track=$scope.cd.musicas.length,$scope.cd.musicas.push(music),api.addMusic(music,function(data,status,headers,config){200==status?(toastr.info(data.message),config.file.message="Enviada",config.file.status=2):(toastr.warning(data.message),config.file.message="Erro ao enviar",config.file.status=0)})}}},cd.deleteMusic=function($scope,musica){var token=auth.getToken();api.deleteMusic(musica,token,function(result){if(200==result.status){toastr.info("Música deletada");var index=$scope.cd.musicas.indexOf(musica);$scope.cd.musicas.splice(index,1)}else toastr.error("Houve um erro ao apagar a música")})},cd.create=function($scope){var token=auth.getToken();api.addCd(token,$scope.cd,function(result){200==result.status?(toastr.success(result.message),$scope.view="songs",$scope.cd.saved=!0,$scope.cd.id=result.cd.id,$scope.cd.musicas=[]):(console.log("error",result),toastr.warning(null!=result.message?result.message:"Ocorreu um erro ao salvar o cd:"+result.status))})},cd.update=function($scope){var token=auth.getToken();api.updateCD($scope.cd,token,function(result){200==result.status?($scope.view="songs",toastr.info("CD atualizado")):toastr.error("Houve um erro ao atualizar o CD")})},cd.updateMusic=function($scope,music){var token=auth.getToken();api.updateMusic(music,token,function(result){console.log("updateMusic",result),200==result.status?toastr.info("Música renomeada"):toastr.error("Houve um erro ao renomear a música")})}}function PlayerCtrl($scope,$rootScope,$timeout,$filter){$scope.playload=!1,$scope.slickConfig={dots:!1,infinite:!1,centerMode:!1,variableWidth:!0,adaptiveHeight:!1,swipe:!0,vertical:!1,slidesToScroll:1,arrows:!0},$scope.hasBeenAddedToPlaylist=function(id){var r=!1;return angular.forEach($scope.playlist,function(song){song.id==id&&(console.log("if"),r=!0)}),r},$scope.getSongById=function(id){for(var k=-1,i=0;i<$scope.playlist.length;i++){var song=$scope.playlist[i];song.id==id&&(k=i)}return k},$rootScope.$on("add-cd-to-playlist",function(event,_cd){var orderBy=$filter("orderBy"),cd=angular.copy(_cd),list=orderBy(cd.musicas,"track",!0);delete cd.musicas,functions.playlist.show(),$scope.playload=!1,angular.forEach(list,function(song){$scope.playlist.unshift({title:song.nome,id:song.id,cd:cd,src:"/public/music/"+song.filename,type:"audio/mp3",mimeType:"image/png"}),$(".progress").width(0),$scope.playload=!1,$timeout(function(){$scope.playload=!0,$scope.player.play(0,!1)})})}),$rootScope.$on("add-to-playlist",function(event,music){var k=$scope.hasBeenAddedToPlaylist(music.id);k?(k=$scope.getSongById(music.id),$scope.player.play(k)):($scope.playlist.unshift({id:music.id,title:music.nome,cd:music.cd,src:"/public/music/"+music.filename,type:"audio/mp3",mimeType:"image/png"}),functions.playlist.show(),$scope.playload=!1,$timeout(function(){$scope.playload=!0,$scope.player.play(0,!1)}))}),$scope.next=function(id){$scope.player.play(id,!1)}}angular.module("musicaApp",["ui.router","ngAnimate","toastr","bardo.directives","angularFileUpload","blockUI","ng-sortable","igTruncate","dcbImgFallback","mediaPlayer","angularMoment"]).run(function($rootScope){functions.playlist.init(this),$rootScope.seekPercentage=function($event){var percentage=$event.offsetX/$event.target.offsetWidth;return 1>=percentage?percentage:0}});var functions=functions||{};functions={playlist:{init:function(element){var _this=$(element);_this.toggleClass("closed"),$("#playlist").hasClass("visible")?functions.playlist.hide():functions.playlist.show()},show:function(){$("#playlist").animate({height:"172px","border-top":0}),$("#playlist .playlist-plug").attr("title","Esconder Playlist"),$("#playlist").addClass("visible")},hide:function(){$("#playlist").animate({height:"5px","border-top":"1px solid #3a3a3a"}),$("#playlist .playlist-plug").attr("title","Abrir Playlist"),$("#playlist").removeClass("visible")}},dropdownGenre:{show:function(element){var _this=$(element);_this.find(".genre-trigger").addClass("active"),_this.find(".genre-dropdown").stop().show()},hide:function(element){var _this=$(element);_this.find(".genre-trigger").removeClass("active"),_this.find(".genre-dropdown").stop().hide()}}},$(window).load(function(){$(document).on("click","#playlist .playlist-plug",function(e){e.preventDefault(),functions.playlist.init(this)}),$(document).on("mouseover","#genre",function(e){e.preventDefault(),functions.dropdownGenre.show(this)}),$(document).on("mouseleave","#genre",function(e){e.preventDefault(),functions.dropdownGenre.hide(this)})}),angular.module("musicaApp").config(function($urlRouterProvider,$stateProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("main",{url:"",templateUrl:"views/main.html",controller:"MainCtrl"}).state("cd",{url:"/cd/:id",templateUrl:"views/cd.html",controller:"CdCtrl"}).state("perfil",{url:"/perfil/:id",controller:"PerfilCtrl",templateUrl:"views/profile.html"}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("painel",{url:"/painel","abstract":!0,templateUrl:"views/painel/painel.html"}).state("novo_cd",{parent:"painel",url:"/cd/novo",controller:"NovoCDCtrl",templateUrl:"views/painel/cd_form.html"}).state("editar_cd",{parent:"painel",url:"/cd/edit/:id",controller:"EditCDCtrl",templateUrl:"views/painel/cd_form.html"}).state("meus_cds",{parent:"painel",url:"/cds",controller:"MeusCDsCtrl",templateUrl:"views/painel/cds.html"}).state("novo_evento",{parent:"painel",url:"/eventos/novo",controller:"NovoEventoCtrl",templateUrl:"views/painel/novo_evento.html"}).state("meus_eventos",{parent:"painel",url:"/eventos",controller:"MeusEventosCtrl",templateUrl:"views/painel/meus_eventos.html"}).state("config",{parent:"painel",url:"/config",controller:"ConfigsCtrl",templateUrl:"views/painel/config.html"}).state("config_password",{parent:"painel",url:"/config/password",controller:"ConfigPasswordCtrl",templateUrl:"views/painel/config_password.html"}).state("genero",{url:"/genero/:id",controller:"GeneroCtrl",templateUrl:"views/genero.html"}).state("busca",{url:"/busca/:q",controller:"BuscaCtrl",templateUrl:"views/busca.html"})}).constant("API_URL","/").config(function(toastrConfig){angular.extend(toastrConfig,{allowHtml:!1,closeButton:!0,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:500,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},tapToDismiss:!0,timeOut:1e3})}).config(function(blockUIConfig){blockUIConfig.message="Carregando",blockUIConfig.delay=10}),angular.module("musicaApp").directive("validateEquals",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){function validateEquals(value){var valid=value===scope.$eval(attrs.validateEquals);return ngModelCtrl.$setValidity("equal",valid),valid?value:void 0}ngModelCtrl.$parsers.push(validateEquals),ngModelCtrl.$formatters.push(validateEquals),scope.$watch(attrs.validateEquals,function(){ngModelCtrl.$setViewValue(ngModelCtrl.$viewValue)})}}}),angular.module("musicaApp").controller("MainCtrl",["$scope","$rootScope","api","$timeout",MainCtrl]),angular.module("musicaApp").controller("SignUpCtrl",["$scope","api","toastr","$timeout",SignUpCtrl]),angular.module("musicaApp").directive("emailValidate",function(){var EMAIL_REGEXP=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[A-Za-z]+\.[A-Za-z]+$/i;return{require:"ngModel",restrict:"",link:function(scope,element,attrs,ctrl){ctrl&&ctrl.$validators.email&&(ctrl.$validators.email=function(modelValue){return ctrl.$isEmpty(modelValue)||EMAIL_REGEXP.test(modelValue)})}}}),angular.module("musicaApp").directive("ngTabs",function(){return{scope:!0,restrict:"EAC",controller:function($scope){$scope.tabs={index:0,count:0},this.headIndex=0,this.bodyIndex=0,this.getTabHeadIndex=function(){return $scope.tabs.count=++this.headIndex},this.getTabBodyIndex=function(){return++this.bodyIndex}}}}).directive("ngTabHead",function(){return{scope:!1,restrict:"EAC",require:"^ngTabs",link:function(scope,element,attributes,controller){var index=controller.getTabHeadIndex(),value=attributes.ngTabHead,active=/[-*\/%^=!<>&|]/.test(value)?scope.$eval(value):!!value;scope.tabs.index=scope.tabs.index||(active?index:null),element.bind("click",function(){scope.tabs.index=index,scope.$$phase||scope.$apply()}),scope.$watch("tabs.index",function(){element.toggleClass("active",scope.tabs.index===index)})}}}).directive("ngTabBody",function(){return{scope:!1,restrict:"EAC",require:"^ngTabs",link:function(scope,element,attributes,controller){var index=controller.getTabBodyIndex();scope.$watch("tabs.index",function(){element.toggleClass(attributes.ngTabBody+" ng-show",scope.tabs.index===index)})}}}),angular.module("musicaApp").controller("LoginCtrl",["$scope","api","toastr",LoginCtrl]),angular.module("musicaApp").controller("HeaderCtrl",["$scope","$rootScope","auth","api","$state",HeaderCtrl]),angular.module("musicaApp").factory("auth",function($window,$rootScope,api){var cachedUser,storage=$window.localStorage,cachedToken="-1";return{setToken:function(token){cachedToken=token,storage.setItem("userToken",token)},getToken:function(){return"-1"==cachedToken&&(cachedToken=storage.getItem("userToken")),cachedToken},isAuthenticated:function(){return"-1"!=this.getToken()},logout:function(){storage.removeItem("userToken"),cachedToken="-1",$rootScope.$emit("update-user-token","-1")},getUser:function(token){if(cachedUser)return cachedUser;var cb=function(result){200==result.status?(cachedUser=result.data,$rootScope.$emit("user-lookup",result.data)):(storage.removeItem("userToken"),cachedToken="-1",$rootScope.$emit("update-user-token","-1"))};return api.lookup(token,cb),cb}}}),angular.module("musicaApp").controller("CdCtrl",["$scope","api","$timeout","$stateParams","$rootScope","toastr",CdCtrl]),angular.module("musicaApp").controller("GeneroCtrl",["$scope","api","toastr","$timeout","$stateParams",GeneroCtrl]),angular.module("musicaApp").controller("BuscaCtrl",["$scope","api","toastr","$timeout","$stateParams",BuscaCtrl]),angular.module("musicaApp").service("api",["ws","$upload","API_URL",api]),angular.module("musicaApp").service("ws",["$rootScope","$http","API_URL",ws]),angular.module("musicaApp").controller("PainelCtrl",["$scope","api",PainelCtrl]),angular.module("musicaApp").controller("NovoCDCtrl",["$scope","cd",NovoCDCtrl]),angular.module("musicaApp").controller("MeusCDsCtrl",["$scope","api","auth","toastr","$timeout",MeusCDsCtrl]),angular.module("musicaApp").controller("NovoEventoCtrl",["$scope","api",NovoEventoCtrl]),angular.module("musicaApp").controller("MeusEventosCtrl",["$scope","api",MeusEventosCtrl]),angular.module("musicaApp").controller("ConfigsCtrl",["$rootScope","$scope","api","auth","$timeout","$state","toastr","$upload",ConfigsCtrl]),angular.module("musicaApp").controller("ConfigPasswordCtrl",["$scope","api","auth","toastr","$state",ConfigPasswordCtrl]),angular.module("musicaApp").controller("PerfilCtrl",["$scope","api","$stateParams","$timeout",PerfilCtrl]),angular.module("musicaApp").controller("EditCDCtrl",["$scope","cd","$stateParams",EditCDCtrl]),angular.module("musicaApp").service("cd",["$timeout","toastr","api","auth","$state","$rootScope",cd]),angular.module("musicaApp").controller("PlayerCtrl",["$scope","$rootScope","$timeout","$filter",PlayerCtrl]);