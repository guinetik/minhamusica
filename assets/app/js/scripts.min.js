"use strict";function MainCtrl($scope,$rootScope,api,$timeout){$scope.home={},$scope.bannersLoaded=!1,$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateHome)}),$scope.updateHome=function(){api.getHome(function(result){200==result.status?($scope.home=result.home,angular.forEach($scope.home.banners,function(banner){banner.mimeType="image/png",banner.src="/public/img/"+banner.src}),$timeout(function(){$scope.bannersLoaded=!0,$scope.slickHandle.slickGoTo(0)},500)):window.location.reload()})},$scope.slickHandle={currentSlide:0},$scope.slickConfig={dots:!1,autoplay:!0,slidesToShow:1,centerMode:!0,arrows:!0,variableWidth:!0,adaptiveHeight:!1,autoplaySpeed:3e3,lazyLoad:"progressive",onAfterChange:function(slide,index){$scope.slickHandle.currentSlide=index,$scope.$apply()}},$scope.slickConfigVertical={dots:!1,autoplay:!0,slidesToShow:5,centerMode:!1,arrows:!0,vertical:!0,adaptiveHeight:!0,autoplaySpeed:3e3,lazyLoad:"progressive"}}function SignUpCtrl($scope,api,toastr,$timeout){$scope.usuario={nome:"",email:"",senha:"",sexo:"m",estadoSelecionado:null,cidadeSelecionada:null,usuarioAceitou:!0,nascimento:new Date,twitter:"",instagram:""},$scope.origem=angular.copy($scope.usuario),$scope.estados=[],$scope.tipos=[],$scope.$on("$viewContentLoaded",function(){$timeout(function(){api.getEstados(function(result){console.log("result",result),$scope.estados=result})})}),$scope.submit=function(){var user={nome:$scope.usuario.nome,email:$scope.usuario.email,senha:$scope.usuario.senha,sexo:$scope.usuario.sexo,nascimento:$scope.usuario.nascimento,cidade:$scope.usuario.cidadeSelecionada.id,twitter:$scope.usuario.twitter,instagram:$scope.usuario.instagram};api.signup(user,function(result){200==result.status?toastr.success(result.message):toastr.warning(result.message)})},$scope.reset=function(){$scope.usuario=angular.copy($scope.origem)}}function LoginCtrl($scope,api,toastr){$scope.usuario={email:"",senha:""},$scope.origem=angular.copy($scope.usuario),$scope.submit=function(){api.login($scope.usuario,function(result){200==result.status?toastr.success(result.message):toastr.warning(result.message?result.message.message:"Ocorreu um erro, tente novamente.")})},$scope.reset=function(){$scope.usuario=angular.copy($scope.origem)}}function HeaderCtrl($scope,$rootScope,auth,api,$state){if($scope.isAuthenticated=auth.isAuthenticated(),$scope.generos=[],$scope.user=null,$scope.isAuthenticated){var token=auth.getToken();auth.getUser(token)}$scope.logout=function(){auth.logout(),$scope.isAuthenticated=!1,$state.go("main")},$rootScope.$on("user-lookup",function(event,user){console.log("user-lookup",user),$scope.user=user}),$rootScope.$on("search-query",function(event,q){$scope.query=q}),$rootScope.$on("update-user-token",function(event,token){if(auth.setToken(token),$scope.isAuthenticated=auth.isAuthenticated(),$scope.isAuthenticated||$state.go("main"),"-1"!=token){{auth.getUser(token)}$state.go("main")}}),api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos)}),$scope.searchCD=function(){$state.go("busca",{q:$scope.query})}}function CdCtrl($scope,api,$timeout,$stateParams,$rootScope,toastr){$scope.cd={},$scope.eventos=[],$scope.related=[],$scope.cd.id=$stateParams.id,$scope.$on("$viewContentLoaded",function(){$timeout(function(){api.getCD($scope.cd.id,function(result){200==result.status&&($scope.cd=result.cd,$scope.eventos=result.eventos,$scope.related=result.related)})})}),$scope.downloadCD=function(){api.downloadCD($scope.cd.id,function(result){console.log("downloadCD",result),200==result.status?(toastr.info(result.message),window.open(result.url)):toastr.warning(result.message?result.message:"Houve um erro. tente novamente")})},$scope.addToPlaylist=function(musica){musica.cd=$scope.cd,$rootScope.$emit("add-to-playlist",musica)},$scope.addAll=function(){$rootScope.$emit("add-cd-to-playlist",$scope.cd)},$scope.shareSong=function(){alert("SHARE")},$scope.downloadSong=function(song){console.log("song",song),api.downloadMusic(song,function(result){console.log("downloadMusic",result),200==result.status?(toastr.info(result.message),window.open(result.url)):toastr.warning(result.message?result.message:"Houve um erro. tente novamente")})}}function GeneroCtrl($scope,api,toastr,$timeout,$stateParams){$scope.cds=[],$scope.genero="",$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateGeneros)}),$scope.updateGeneros=function(){var id=$stateParams.id;api.getCdsByGenero(id,function(result){200==result.status&&($scope.genero=result.genero,$scope.cds=result.cds)})}}function BuscaCtrl($scope,api,toastr,$timeout,$stateParams,$rootScope){$scope.cds=[],$scope.eventos=[],$scope.musicas=[],$scope.$on("$viewContentLoaded",function(){$timeout($scope.searchCD)}),$scope.searchCD=function(){var q=$stateParams.q;null!=q&&($rootScope.$emit("search-query",q),api.searchCD(q,function(result){200==result.status&&($scope.cds=result.cds,$scope.eventos=result.eventos,$scope.musicas=result.musicas)}))},$scope.addToPlaylist=function(musica,cd){musica.cd=cd,$rootScope.$emit("add-to-playlist",musica)},$scope.downloadSong=function(song){console.log("song",song),api.downloadMusic(song,function(result){console.log("downloadMusic",result),200==result.status?(toastr.info(result.message),window.open(result.url)):toastr.warning(result.message?result.message:"Houve um erro. tente novamente")})}}function EventoCtrl($scope,api,$stateParams,$timeout){$scope.evento={},$scope.map={center:{latitude:45,longitude:-73},zoom:14,options:{scrollwheel:!1}},$scope.id=$stateParams.id,$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateEvent)}),$scope.updateEvent=function(){console.log("updateEvent",$scope.id),api.getEvent($scope.id,function(result){console.log("updateEvent",result),200==result.status&&($scope.evento=result,$scope.updateMap())})},$scope.updateMap=function(){$scope.map.center={latitude:$scope.evento.local.location.lat,longitude:$scope.evento.local.location.lng},$scope.marker={id:0,coords:{latitude:$scope.map.center.latitude,longitude:$scope.map.center.longitude},options:{scrollwheel:!1},events:{click:function(){$scope.marker.options={draggable:!1,labelContent:"lat: "+$scope.marker.coords.latitude+" lon: "+$scope.marker.coords.longitude,labelAnchor:"100 0",labelClass:"marker-labels"}}}}}}function EventosCtrl($scope,api,toastr,$timeout){$scope.eventos=[],$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateEventos)}),$scope.updateEventos=function(){api.getLatestEvents(function(result){200==result.status&&($scope.eventos=result.eventos)})}}function api(ws,$upload,API_URL,blockUI){function mZero(s){return 10>s?"0"+s.toString():s.toString()}var api=this;api.getEstados=function(cb){ws.consumeService("data/estados",null,null,cb,!1,"GET")},api.getHome=function(cb){ws.consumeService("data/home",null,null,cb,!1,"GET")},api.getGeneros=function(cb){ws.consumeService("data/generos",null,null,cb,!1,"GET")},api.signup=function(user,cb){ws.consumeService("usuarios/create",user,null,cb,!1)},api.login=function(user,cb){ws.consumeService("user/login",user,null,cb,!1)},api.lookup=function(token,cb){ws.consumeService("usuarios/lookup",null,token,cb,!1)},api.addCd=function(token,cd,cb){ws.consumeService("cd/add",cd,token,cb,!1)},api.addEvento=function(token,evento,cb){evento.local=evento.local.name,ws.consumeService("eventos/create",evento,token,cb,!1)},api.saveCd=function(token,cd,cb){ws.consumeService("cd/save",{id_cd:cd.id},token,cb,!1)},api.addMusic=function(musica,token,cb){blockUI.start(),$upload.upload({url:API_URL+"cd/music/add",method:"POST",data:{id_cd:musica.cd,track:musica.track},headers:{token:token},file:musica.file}).progress(function(evt){musica.progress=parseInt(100*evt.loaded/evt.total),musica.status=1,musica.message="Enviando: "+musica.progress+"%"}).success(function(data,status,headers,config){blockUI.stop(),200==status?(musica.status=2,musica.message="Enviada",musica.cd=data.musica.cd,musica.id=data.musica.id,musica.nome=data.musica.nome,musica.filename=data.musica.filename,delete musica.file):(musica.status=-1,musica.message="Erro ao enviar"),data.status=status,cb(data,status,headers,config)})},api.deleteMusic=function(music,token,cb){ws.consumeService("musica/destroy/"+music.id,{id_music:music.id},token,cb,!1,"POST")},api.deleteCd=function(cd,token,cb){ws.consumeService("cd/destroy/"+cd.id,{id_cd:cd.id},token,cb,!1,"POST")},api.deleteEvent=function(event,token,cb){ws.consumeService("eventos/destroy/"+event.id,{id_evento:event.id},token,cb,!1,"POST")},api.updateMusic=function(music,token,cb){var m={id_music:music.id,cd:music.cd,nome:music.nome};ws.consumeService("musica/update/"+music.id,m,token,cb,!1)},api.updateEvent=function(event,token,cb){var e={id:event.id,id_event:event.id,nome:event.nome,descricao:event.descricao,local:event.local.name,cidade:event.cidade.id,inicio:event.inicio,fim:event.fim,foto:event.foto,link:event.link};ws.consumeService("eventos/update/"+e.id,e,token,cb,!1)},api.updateTrack=function(music,token,cb){var m={id_music:music.id,track:music.track};ws.consumeService("musica/update/track",m,token,cb,!1)},api.updateCover=function(file,capa,token,cb){var data={};capa.cd&&(data.id=capa.cd),blockUI.start(),$upload.upload({url:API_URL+"cd/cover/update",method:"POST",data:data,headers:{token:token},file:file}).progress(function(evt){capa.progress=parseInt(100*evt.loaded/evt.total),capa.status=1,capa.message="Enviando: "+capa.progress+"%"}).success(function(data,status,headers,config){200==status?(capa.status=2,capa.message="Enviada",capa.imagem=data.imagem):(capa.status=-1,capa.message="Erro ao enviar"),blockUI.stop(),cb(data,status,headers,config)})},api.updateUserCover=function(file,capa,token,cb){var data={};capa.user&&(data.id_user=capa.user),blockUI.start(),$upload.upload({url:API_URL+"user/cover/update",method:"POST",data:data,headers:{token:token},file:file}).progress(function(evt){capa.progress=parseInt(100*evt.loaded/evt.total),capa.status=1,capa.message="Enviando: "+capa.progress+"%"}).success(function(data,status,headers,config){200==status?(capa.status=2,capa.message="Enviada",capa.imagem=data.imagem):(capa.status=-1,capa.message="Erro ao enviar"),blockUI.stop(),cb(data,status,headers,config)})},api.updateUserFoto=function(file,foto,token,cb){var data={};foto.user&&(data.id_user=foto.user),blockUI.start(),$upload.upload({url:API_URL+"user/foto/update",method:"POST",data:data,headers:{token:token},file:file}).progress(function(evt){foto.progress=parseInt(100*evt.loaded/evt.total),foto.status=1,foto.message="Enviando: "+foto.progress+"%"}).success(function(data,status,headers,config){200==status?(foto.status=2,foto.message="Enviada",foto.imagem=data.imagem):(foto.status=-1,foto.message="Erro ao enviar"),blockUI.stop(),cb(data,status,headers,config)})},api.updateEventPicture=function(file,foto,token,cb){var data={};foto.evento&&(data.id_evento=foto.evento),blockUI.start(),$upload.upload({url:API_URL+"evento/foto/update",method:"POST",data:data,headers:{token:token},file:file}).progress(function(evt){foto.progress=parseInt(100*evt.loaded/evt.total),foto.status=1,foto.message="Enviando: "+foto.progress+"%"}).success(function(data,status,headers,config){200==status?(foto.status=2,foto.message="Enviada",foto.imagem=data.imagem):(foto.status=-1,foto.message="Erro ao enviar"),blockUI.stop(),cb(data,status,headers,config)})},api.getLatestEvents=function(cb){ws.consumeService("eventos/latest",null,null,cb,!1,"GET")},api.getUserCollection=function(token,cb){ws.consumeService("usuarios/collection",null,token,cb,!1,"GET")},api.getUserEvents=function(token,cb){ws.consumeService("usuarios/eventos",null,token,cb,!1,"GET")},api.getProfile=function(id,cb){ws.consumeService("usuarios/perfil?id="+id,null,null,cb,!1,"GET")},api.getCD=function(id,cb){ws.consumeService("cd/get?id="+id,null,null,cb,!1,"GET")},api.getEvent=function(id,cb){ws.consumeService("eventos/"+id,null,null,cb,!1,"GET")},api.updateProfile=function(user,token,cb){var u={id_user:user.id,id:user.id,nome:user.nome,email:user.email,about:user.about,sexo:user.sexo,cidade:user.cidade.id,twitter:user.twitter,facebook:user.facebook,instagram:user.instagram,nascimento:user.nascimento};ws.consumeService("usuarios/"+user.id,u,token,cb,!1)},api.updateCD=function(cd,token,cb){var c={id_cd:cd.id,id:cd.id,titulo:cd.titulo,descricao:cd.descricao,"private":cd["private"],capa:cd.capa,genero:cd.genero};ws.consumeService("cd/update/"+cd.id,c,token,cb,!1)},api.updatePassword=function(user,token,cb){user.id_user=user.id,ws.consumeService("user/password/update",user,token,cb,!1)},api.downloadCD=function(id,cb){ws.consumeService("cd/download/",{id:id},null,cb,!1,"POST")},api.downloadMusic=function(id,cb){ws.consumeService("musica/download/",{id:id},null,cb,!1,"POST")},api.getCdsByGenero=function(id,cb){ws.consumeService("cd/genero?id="+id,null,null,cb,!1,"GET")},api.searchCD=function(q,cb){ws.consumeService("cd/search?q="+q,null,null,cb,!1,"GET")},api.searchPlace=function(query,cidade,cb){var cid="EKMXJ3PZOKGAGZIVNWTRLXTTSMW4KOXSD0X0RROJCBNYDYB4",shh="NMTM2OWFGHC3XDINPQBWT4LO1HSOLLAWZGJKNRABFSBSFOS2",url="https://api.foursquare.com/v2/venues/search";url+="?client_id="+cid,url+="&client_secret="+shh,url+="&v=20130815",url+="&near="+cidade.nome,url+="&query="+query,ws.consumeService(url,null,null,function(result){cb(result)},!0,"GET",!1)},api.voteForArtist=function(artist,cb){console.log("api.voteForArtist",artist),ws.consumeService("http://votofestival.com.br/principal/time",null,null,function(result){if(result.time){console.log("time",result.time);var date=moment(result.time).toDate();console.log("date",date);var secret="dalejaum100",fDate=mZero(date.getMonth()+1)+mZero(date.getMinutes())+date.getFullYear().toString()+mZero(date.getDate())+mZero(date.getHours());console.log("fDate",fDate);var hash=fDate+secret,mobile_banda_nome=artist.usuario.nome,mobile_banda_id=artist.usuario.id,mobile_id=md5(fDate),token=md5(hash),params={token:token,mobile_banda_id:mobile_banda_id,mobile_banda_nome:mobile_banda_nome,mobile_id:mobile_id};console.log("params",params),ws.consumeService("http://votofestival.com.br/principal/votarMobile",params,null,function(result){console.log("votarMobile",result)},!0,"POST",!0)}else cb(!1)},!0,"POST",!0)},api.confirmVote=function(artist,confirmation,cb){var params={codigo:confirmation,video_id:artist.usuario.id};ws.consumeService("http://votofestival.com.br/principal/votar",params,null,function(result){console.log("result",result),cb(result)},!0,"POST",!0)},api.voteSMS=function(artist,cell_phone,cb){var params={celular:cell_phone,video_id:artist.usuario.id,video_nome:artist.usuario.nome,thumb:artist.usuario.foto};ws.consumeService("http://votofestival.com.br/principal/enviarSMS",params,null,function(result){console.log("result",result),cb(result)},!0,"POST",!0)}}function ws($rootScope,$http,API_URL,blockUI){var ws=this,m="POST";ws.baseURL=API_URL,ws.consumeService=function(endpoint,params,token,cb,overrideBase,method,shouldBlockUI){var serviceURL;if(token){console.log("tem token");var headers={"content-type":"application/json"};headers.token=token}else headers=null;null==shouldBlockUI&&(shouldBlockUI=!0),params||(params=null),method||(method=m),serviceURL=overrideBase?endpoint:ws.baseURL+endpoint,console.log("method",method),shouldBlockUI&&blockUI.start(),$http({url:serviceURL,method:method,data:params,headers:headers}).success(function(result,status){blockUI.stop(),result.status=status,200==status&&result.token&&$rootScope.$emit("update-user-token",result.token),cb&&cb(result)}).error(function(err,status){blockUI.stop(),console.log("errror"),cb({message:err,status:status})})}}function PainelCtrl($scope){$scope.$on("$viewContentLoaded",function(){console.log("PainelCtrl:viewContentLoaded")})}function NovoCDCtrl($scope,cd,api,auth,$state,$rootScope,$timeout){$scope.cd={musicas:[]},$scope.generos=[],$scope.files=[],$scope.capas=[],$scope.capa={},cd.scope=$scope,$scope.sortOptions=cd.sortOptions,$scope.view="basic",$scope.title="NOVO CD",$scope.toggleState=function(view){$scope.cd.saved&&($scope.view=view)},$scope.$on("$viewContentLoaded",function(){$timeout(function(){var token=auth.getToken();"-1"!=token?api.lookup(token,function(result){200==result.status?(cd.getGeneros($scope),$scope.usuario=result.data,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.generateThumb=function(file){cd.generateThumb($scope,file)},$scope.updateCover=function(file){cd.updateCover($scope,file)},$scope.fileDropped=function($files,$event,$rejectedFiles){cd.fileDropped($scope,$files,$event,$rejectedFiles)},$scope.deleteMusic=function(musica){cd.deleteMusic($scope,musica)},$scope.submit=function(){console.log("cd",$scope.cd),cd.create($scope)},$scope.salvarCd=function(){cd.saveCd($scope)},$scope.updateMusic=function(music){cd.updateMusic($scope,music)},$scope.addToPlaylist=function(song){cd.addToPlaylist($scope,song)}}function MeusCDsCtrl($scope,api,auth,toastr,$timeout,$rootScope,$state){$scope.cds=[];var token=auth.getToken();$scope.$on("$viewContentLoaded",function(){$timeout(function(){"-1"!=token?api.lookup(token,function(result){200==result.status?($timeout($scope.updateCollection),$scope.usuario=result.data,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.updateCollection=function(){api.getUserCollection(token,function(result){200==result.status&&($scope.cds=result.cds)})},$scope.deleteCd=function(cd){api.deleteCd(cd,token,function(result){200==result.status?(toastr.info("CD Excluído"),$scope.updateCollection()):toastr.warning("Houve um erro ao excluir o cd")})}}function NovoEventoCtrl($scope,api,auth,$state,$rootScope,$timeout,toastr,$stateParams){var d=new Date;$scope.evento={inicio:d,fim:d},$scope.today=(new Date).toISOString().split("T")[0],$scope.getDateString=function(datee){if(datee)var k=datee.toISOString().split("T")[0];else k=$scope.today;return k},$scope.$on("$viewContentLoaded",function(){$timeout(function(){var token=auth.getToken();"-1"!=token?api.lookup(token,function(result){200==result.status?(api.getEstados(function(result){$scope.estados=result,$stateParams.id&&api.getEvent($stateParams.id,function(result){console.log("getEvent",result),200==result.status&&($scope.evento.nome=result.nome,$scope.evento.descricao=result.descricao,$scope.evento.local.name=result.local,$scope.evento.foto=result.foto,$scope.evento.id=$stateParams.id,$scope.foto={dataUrl:"/public/img/"+result.foto,imagem:result.foto},$scope.evento.inicio=new Date(result.inicio),$scope.evento.fim=new Date(result.fim),$scope.getEstadoSelecionado(result.cidade.estado),$scope.getCidadeSelecionada(result.cidade.id))})}),$scope.usuario=result.data,$scope.evento.usuario=$scope.usuario.id,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.submit=function(){var token=auth.getToken();null!=$stateParams.id?(console.log("UpdateEvent"),$scope.evento.id=$stateParams.id,api.updateEvent($scope.evento,token,function(result){console.log("Result",result),200==result.status?(toastr.success(result.message),$state.go("meus_eventos")):(console.log("error",result),toastr.warning(null!=result.message?result.message:"Ocorreu um erro ao salvar o evento:"+result.status))})):api.addEvento(token,$scope.evento,function(result){200==result.status?(toastr.success(result.message),$state.go("meus_eventos")):(console.log("error",result),toastr.warning(null!=result.message?result.message:"Ocorreu um erro ao salvar o evento:"+result.status))})},$scope.updateEventPicture=function(file){console.log("updateEventPicture"),null!=$scope.evento.id&&($scope.foto.evento=$scope.evento.id);var token=auth.getToken();api.updateEventPicture(file,$scope.foto,token,function(data,status){200==status?(toastr.info(data.message),$scope.evento.foto=data.imagem):toastr.warning(data.message)})},$scope.generateThumb=function(file){console.log("foto nova",file),null!=file&&file.type.indexOf("image")>-1&&($scope.updateEventPicture(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){$scope.foto.dataUrl=e.target.result,console.log("foto nova",e.target.result)})}}))},$scope.getCidadeSelecionada=function(id){angular.forEach($scope.evento.estadoSelecionado.cidades,function(c){c.id==id&&($scope.evento.cidade=c)})},$scope.getEstadoSelecionado=function(estado){angular.forEach($scope.estados,function(e){e.id==estado&&($scope.evento.estadoSelecionado=e)})},$scope.isValidStartDate=function($value){return $value.getTime()>d.getTime()},$scope.isValidEndDate=function($value){return $value.getTime()>$scope.evento.inicio.getTime()},$scope.searchPlaces=function(){$scope.evento.local&&$scope.evento.cidade&&$scope.evento.local.name.length>2&&api.searchPlace($scope.evento.local.name,$scope.evento.cidade,function(result){console.log("result",result),200==result.status&&$scope.updateAutoComplete(result.response.venues)})},$scope.updateAutoComplete=function(venues){$scope.placesCollection?($scope.placesCollection.clear(),angular.forEach(venues,function(venue){console.log("venue",venue.id,venue.name),$scope.placesCollection.add(venue)})):($scope.placesCollection=new Bloodhound({datumTokenizer:function(d){return Bloodhound.tokenizers.whitespace(d.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:venues}),$scope.placesCollection.initialize(),$scope.typeaheadOptions={highlight:!0},$scope.suggestions={displayKey:"name",source:$scope.placesCollection.ttAdapter()})},$scope.updateAutoComplete([{name:"B"}])}function MeusEventosCtrl($scope,api,auth,$state,$rootScope,$timeout,toastr){$scope.eventos=[];var token=auth.getToken();$scope.$on("$viewContentLoaded",function(){$timeout(function(){"-1"!=token?api.lookup(token,function(result){200==result.status?($timeout($scope.updateEvents),$scope.usuario=result.data,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.updateEvents=function(){api.getUserEvents(token,function(result){200==result.status?($scope.eventos=result.eventos,console.log("eventos",$scope.eventos)):toastr.warning(result.message)})},$scope.deleteEvent=function(event){api.deleteEvent(event,token,function(result){200==result.status?(toastr.info("Evento Excluído"),$scope.updateEvents()):toastr.warning("Houve um erro ao excluir o evento")})}}function ConfigsCtrl($rootScope,$scope,api,auth,$timeout,$state,toastr,$upload){$scope.usuario={},$scope.capa={},$scope.foto={},$scope.estados=[],console.log($upload),$scope.$on("$viewContentLoaded",function(){var token=auth.getToken();$timeout(function(){api.lookup(token,function(result){if(200==result.status){var user=result.data;api.getEstados(function(result){$scope.estados=result,$scope.usuario.id=user.id,$scope.usuario.capa=user.capa,$scope.usuario.foto=user.foto,$scope.usuario.nome=user.nome,$scope.usuario.email=user.email,$scope.usuario.twitter=user.twitter,$scope.usuario.facebook=user.facebook,$scope.usuario.about=user.about,$scope.usuario.sexo=user.sexo,$scope.usuario.instagram=user.instagram,$scope.capa.dataUrl=$scope.capa.imagem="/public/img/"+user.capa,$scope.foto.dataUrl=$scope.foto.imagem="/public/img/"+user.foto,$scope.getEstadoSelecionado(user.cidade.estado),$scope.getCidadeSelecionada(user.cidade.id),$scope.usuario.nascimento=new Date(user.nascimento),$rootScope.$emit("user-lookup",$scope.usuario)})}else $state.go("main")})})}),$scope.getCidadeSelecionada=function(id){angular.forEach($scope.estado.cidades,function(c){c.id==id&&($scope.usuario.cidade=c)})},$scope.getEstadoSelecionado=function(estado){console.log("fowkefo",estado),angular.forEach($scope.estados,function(e){console.log("estado",e.id,estado),e.id==estado&&($scope.estado=e)})},$scope.submit=function(){var token=auth.getToken();api.updateProfile($scope.usuario,token,function(result){200==result.status?($rootScope.$emit("user-lookup",result),toastr.success("Perfil atualizado")):toastr.error("Houve um erro ao atualizar o perfil.")})},$scope.generateCoverThumb=function(file){null!=file&&(console.log("capa nova",file),file.type.indexOf("image")>-1&&($scope.updateUserCover(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){console.log("capa nova",e.target.result),$scope.capa.dataUrl=e.target.result})}})))},$scope.updateUserCover=function(file){null!=$scope.usuario.id&&($scope.capa.user=$scope.usuario.id);var token=auth.getToken();api.updateUserCover(file,$scope.capa,token,function(data,status){200==status?(toastr.info(data.message),$scope.usuario.capa=data.imagem,$rootScope.$emit("user-lookup",$scope.usuario)):toastr.warning(data.message)})},$scope.updateUserFoto=function(file){console.log("updateFoto"),null!=$scope.usuario.id&&($scope.foto.user=$scope.usuario.id);var token=auth.getToken();api.updateUserFoto(file,$scope.foto,token,function(data,status){200==status?(toastr.info(data.message),$scope.usuario.foto=data.imagem,$rootScope.$emit("user-lookup",$scope.usuario)):toastr.warning(data.message)})},$scope.generateThumb=function(file){console.log("foto nova",file),null!=file&&file.type.indexOf("image")>-1&&($scope.updateUserFoto(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){$scope.foto.dataUrl=e.target.result,console.log("foto nova",e.target.result)})}}))}}function ConfigPasswordCtrl($scope,api,auth,toastr,$state,$rootScope,$timeout){$scope.$on("$viewContentLoaded",function(){$timeout(function(){var token=auth.getToken();"-1"!=token?api.lookup(token,function(result){200==result.status?($scope.usuario=result.data,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.submit=function(){var token=auth.getToken();api.updatePassword($scope.usuario,token,function(result){200==result.status?(toastr.info(result.message),$state.go("main")):toastr.warning(result.message)})}}function PerfilCtrl($scope,api,$stateParams,$timeout,toastr,$dialogs){$scope.perfil={},$scope.id=$stateParams.id,$scope.$on("$viewContentLoaded",function(){$timeout($scope.updateProfile)}),$scope.updateProfile=function(){console.log("updateProfile",$scope.id),api.getProfile($scope.id,function(result){console.log("updateProfile",result),200==result.status&&($scope.perfil=result.perfil)})},$scope.processVote=function(){var dlg=$dialogs.create("views/sms_dialog.html","SMSController",{},{key:!1,back:"static"});dlg.result.then(function(cell_number){console.log("cell_number",cell_number),api.voteSMS($scope.perfil,cell_number,function(result){if(console.log("voteForArtist",result),result.error)toastr.warning(result.msg);else{toastr.success(result.msg);var confirm_code_dialog=$dialogs.create("views/code_dialog.html","ConfirmController",{},{key:!1,back:"static"});confirm_code_dialog.result.then(function(confirmation){console.log("confirmation",confirmation),api.confirmVote($scope.perfil,confirmation,function(result){console.log("confirmVote",result),result.error?toastr.warning(result.msg):toastr.success(result.msg)})},function(){})}})},function(){})}}function EditCDCtrl($scope,cd,$stateParams,$rootScope,auth,$state,api,$timeout){$scope.cd={},$scope.musicas=[],$scope.generos=[],$scope.capas=[],$scope.capa={},$scope.view="basic",$scope.pendingChanges=!1,cd.scope=$scope,$scope.sortOptions=cd.sortOptions,$scope.cd.id=$stateParams.id,$scope.title="EDITAR CD",$scope.toggleState=function(view){$scope.cd.saved&&($scope.view=view)},$scope.generateThumb=function(file){cd.generateThumb($scope,file),$scope.pendingChanges=!0},$scope.updateCover=function(file){cd.updateCover($scope,file),$scope.pendingChanges=!0},$scope.fileDropped=function($files,$event,$rejectedFiles){cd.fileDropped($scope,$files,$event,$rejectedFiles),$scope.pendingChanges=!0},$scope.deleteMusic=function(musica){cd.deleteMusic($scope,musica),$scope.pendingChanges=!0},$scope.submit=function(){cd.update($scope),$scope.pendingChanges=!0},$scope.salvarCd=function(){cd.saveCd($scope)},$scope.updateMusic=function(music){cd.updateMusic($scope,music),$scope.pendingChanges=!0},$scope.$on("$viewContentLoaded",function(){$timeout(function(){var token=auth.getToken();"-1"!=token?api.lookup(token,function(result){200==result.status?(cd.getCd($scope),$scope.usuario=result.data,$rootScope.$emit("user-lookup",$scope.usuario)):$state.go("main")}):$state.go("main")})}),$scope.addToPlaylist=function(song){cd.addToPlaylist($scope,song)},$scope.$on("$stateChangeStart",function(event){if(console.log("$stateChangeStart"),$scope.pendingChanges){console.log("PendingChanges"),event.preventDefault();var k=confirm("Você fez mudanças no CD. Deseja salvar agora?");k&&cd.saveCd($scope)}})}function cd($timeout,toastr,api,auth,$state,$rootScope){var cd=this;cd.getGeneros=function($scope){$timeout(function(){api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos)})})},cd.sortOptions={ghostClass:"drop-ghost",animation:150,onUpdate:function(event,a){var token=auth.getToken();angular.forEach(cd.scope.cd.musicas,function(musica){angular.forEach(a,function(musicaa,key){if(musica.id==musicaa.id){var track=key+1;musica.track!=track&&(musica.track=key+1,api.updateTrack(musica,token,function(result){console.log("UpdateTrack",result)}))}})})}},cd.saveCd=function($scope){var token=auth.getToken();api.saveCd(token,$scope.cd,function(result){200==result.status?(toastr.info(result.message),$scope.pendingChanges=!1,$state.go("cd",{id:$scope.cd.id})):toastr.warning(result.message)})},cd.addToPlaylist=function($scope,musica){var song=angular.copy(musica),_cd=angular.copy($scope.cd);delete _cd.musicas,song.cd=_cd,$rootScope.$emit("add-to-playlist",song)},cd.getCd=function($scope){$timeout(function(){api.getGeneros(function(result){200==result.status&&($scope.generos=result.generos,api.getCD($scope.cd.id,function(result){200==result.status&&($scope.cd=result.cd,$scope.cd.saved=!0,$scope.musicas&&($scope.musicas=$scope.cd.musicas),$scope.capa.dataUrl=$scope.capa.imagem="/public/img/"+$scope.cd.capa,cd.setMusicStatus($scope))}))})})},cd.setMusicStatus=function($scope){var musicas=$scope.cd.musicas;angular.forEach(musicas,function(value){value.status=2,value.message="Enviada"})},cd.generateThumb=function($scope,file){null!=file&&file.type.indexOf("image")>-1&&($scope.updateCover(file),$timeout(function(){var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){$timeout(function(){$scope.capa.dataUrl=e.target.result})}}))},cd.updateCover=function($scope,file){null!=$scope.cd.id&&($scope.capa.cd=$scope.cd.id);var token=auth.getToken();api.updateCover(file,$scope.capa,token,function(data,status){200==status?(toastr.info(data.message),$scope.cd.capa=data.imagem):toastr.warning(data.message)})},cd.fileDropped=function($scope,$files){for(var token=auth.getToken(),i=0;i<$files.length;i++){var filename=$files[i].name;if("mp3"==filename.substr(filename.length-3,3)){var file=$files[i],music={};music.file=file,music.status=0,music.cd=$scope.cd.id,music.nome=file.name,music.track=$scope.cd.musicas.length+1,console.log("music",music),$scope.cd.musicas.push(music),api.addMusic(music,token,function(data,status,headers,config){200==status?(toastr.info(data.message),config.file.message="Enviada",config.file.status=2):(toastr.warning(data.message),config.file.message="Erro ao enviar",config.file.status=0)})}}},cd.deleteMusic=function($scope,musica){var token=auth.getToken();api.deleteMusic(musica,token,function(result){if(200==result.status){toastr.info("Música deletada");var index=$scope.cd.musicas.indexOf(musica);$scope.cd.musicas.splice(index,1)}else toastr.error("Houve um erro ao apagar a música")})},cd.create=function($scope){var token=auth.getToken();api.addCd(token,$scope.cd,function(result){200==result.status?(toastr.success(result.message),$scope.view="songs",$scope.cd.saved=!0,$scope.cd.id=result.cd.id,$scope.cd.musicas=[]):(console.log("error",result),toastr.warning(null!=result.message?result.message:"Ocorreu um erro ao salvar o cd:"+result.status))
})},cd.update=function($scope){var token=auth.getToken();api.updateCD($scope.cd,token,function(result){200==result.status?($scope.view="songs",toastr.info("CD atualizado")):toastr.error("Houve um erro ao atualizar o CD")})},cd.updateMusic=function($scope,music){var token=auth.getToken();api.updateMusic(music,token,function(result){console.log("updateMusic",result),200==result.status?toastr.info("Música renomeada"):toastr.error("Houve um erro ao renomear a música")})}}function PlayerCtrl($scope,$rootScope,$timeout,$filter){$scope.playload=!1,$scope.slickConfig={dots:!1,infinite:!1,centerMode:!1,variableWidth:!0,adaptiveHeight:!1,swipe:!0,vertical:!1,slidesToScroll:1,arrows:!0},$scope.hasBeenAddedToPlaylist=function(id){var r=!1;return angular.forEach($scope.playlist,function(song){song.id==id&&(console.log("if"),r=!0)}),r},$scope.clearPlaylist=function(){$scope.playlist=[]},$scope.getSongById=function(id){for(var k=-1,i=0;i<$scope.playlist.length;i++){var song=$scope.playlist[i];song.id==id&&(k=i)}return k},$rootScope.$on("add-cd-to-playlist",function(event,_cd){var orderBy=$filter("orderBy"),cd=angular.copy(_cd),list=orderBy(cd.musicas,"track",!0);delete cd.musicas,functions.playlist.show(),$scope.playload=!1,angular.forEach(list,function(song){$scope.playlist.unshift({title:song.nome,id:song.id,cd:cd,src:"/public/music/"+song.filename,type:"audio/mp3",mimeType:"image/png"}),$(".progress").width(0),$scope.playload=!1,$timeout(function(){$scope.playload=!0,$scope.player.play(0,!1)})})}),$rootScope.$on("add-to-playlist",function(event,music){var k=$scope.hasBeenAddedToPlaylist(music.id);k?(k=$scope.getSongById(music.id),$scope.player.play(k)):($scope.playlist.unshift({id:music.id,title:music.nome,cd:music.cd,src:"/public/music/"+music.filename,type:"audio/mp3",mimeType:"image/png"}),functions.playlist.show(),$scope.playload=!1,$timeout(function(){$scope.playload=!0,$scope.player.play(0,!1)}))}),$scope.next=function(id){$scope.player.play(id,!1)}}!function(a){function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this),angular.module("musicaApp",["ui.router","ui.validate","ngAnimate","toastr","bardo.directives","angularFileUpload","blockUI","ng-sortable","igTruncate","ezfb","dcbImgFallback","mediaPlayer","siyfion.sfTypeahead","q-date","uiGmapgoogle-maps","dateParser","ui.bootstrap","ui.utils.masks","dialogs","angularMoment"]).run(function($rootScope){functions.playlist.init(this),$rootScope.seekPercentage=function($event){var percentage=$event.offsetX/$event.target.offsetWidth;return 1>=percentage?percentage:0}});var functions=functions||{};functions={playlist:{init:function(element){var _this=$(element);_this.toggleClass("closed"),$("#playlist").hasClass("visible")?functions.playlist.hide():functions.playlist.show()},show:function(){$("#playlist").animate({height:"172px","border-top":0}),$("#playlist .playlist-plug").attr("title","Esconder Playlist"),$("#playlist").addClass("visible")},hide:function(){$("#playlist").animate({height:"5px","border-top":"1px solid #3a3a3a"}),$("#playlist .playlist-plug").attr("title","Abrir Playlist"),$("#playlist").removeClass("visible")}},dropdownGenre:{show:function(element){var _this=$(element);_this.find(".genre-trigger").addClass("active"),_this.find(".genre-dropdown").stop().show()},hide:function(element){var _this=$(element);_this.find(".genre-trigger").removeClass("active"),_this.find(".genre-dropdown").stop().hide()}}},$(window).load(function(){$(document).on("click","#playlist .playlist-plug",function(e){e.preventDefault(),functions.playlist.init(this)}),$(document).on("mouseover","#genre",function(e){e.preventDefault(),functions.dropdownGenre.show(this)}),$(document).on("mouseleave","#genre",function(e){e.preventDefault(),functions.dropdownGenre.hide(this)})}),angular.module("musicaApp").config(function($urlRouterProvider,$stateProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("main",{url:"",templateUrl:"views/main.html",controller:"MainCtrl"}).state("cd",{url:"/cd/:id",templateUrl:"views/cd.html",controller:"CdCtrl"}).state("perfil",{url:"/perfil/:id",controller:"PerfilCtrl",templateUrl:"views/profile.html"}).state("evento",{url:"/evento/:id",controller:"EventoCtrl",templateUrl:"views/evento.html"}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("painel",{url:"/painel","abstract":!0,templateUrl:"views/painel/painel.html"}).state("novo_cd",{parent:"painel",url:"/cd/novo",controller:"NovoCDCtrl",templateUrl:"views/painel/cd_form.html"}).state("editar_cd",{parent:"painel",url:"/cd/edit/:id",controller:"EditCDCtrl",templateUrl:"views/painel/cd_form.html"}).state("meus_cds",{parent:"painel",url:"/cds",controller:"MeusCDsCtrl",templateUrl:"views/painel/cds.html"}).state("novo_evento",{parent:"painel",url:"/eventos/novo",controller:"NovoEventoCtrl",templateUrl:"views/painel/novo_evento.html"}).state("editar_evento",{parent:"painel",url:"/eventos/edit/:id",controller:"NovoEventoCtrl",templateUrl:"views/painel/novo_evento.html"}).state("meus_eventos",{parent:"painel",url:"/eventos",controller:"MeusEventosCtrl",templateUrl:"views/painel/meus_eventos.html"}).state("config",{parent:"painel",url:"/config",controller:"ConfigsCtrl",templateUrl:"views/painel/config.html"}).state("config_password",{parent:"painel",url:"/config/password",controller:"ConfigPasswordCtrl",templateUrl:"views/painel/config_password.html"}).state("genero",{url:"/genero/:id",controller:"GeneroCtrl",templateUrl:"views/genero.html"}).state("eventos",{url:"/eventos",controller:"EventosCtrl",templateUrl:"views/eventos.html"}).state("busca",{url:"/busca/:q",controller:"BuscaCtrl",templateUrl:"views/busca.html"}).state("termos",{url:"/termos",templateUrl:"views/termos.html"}).state("privacidade",{url:"/privacidade",templateUrl:"views/policies.html"}).state("sobre",{url:"/sobre",templateUrl:"views/sobre.html"}).state("contato",{url:"/contato",templateUrl:"views/contato.html"})}).constant("API_URL","/").config(function(toastrConfig){angular.extend(toastrConfig,{allowHtml:!1,closeButton:!0,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:500,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},tapToDismiss:!0,timeOut:1e3})}).config(function(uiGmapGoogleMapApiProvider){uiGmapGoogleMapApiProvider.configure({v:"3.17",libraries:""})}).config(function(blockUIConfig){blockUIConfig.autoBlock=!1,blockUIConfig.resetOnException=!1,blockUIConfig.message="Carregando",blockUIConfig.delay=10}).config(function(ezfbProvider){ezfbProvider.setLocale("pt_br"),ezfbProvider.setInitParams({appId:"425861320888040",version:"v2.0"})}).constant("angularMomentConfig",{calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"[last] dddd [at] LT",nextWeek:"dddd [at] LT",sameElse:"L LT"}}),angular.module("musicaApp").directive("validateEquals",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){function validateEquals(value){var valid=value===scope.$eval(attrs.validateEquals);return ngModelCtrl.$setValidity("equal",valid),valid?value:void 0}ngModelCtrl.$parsers.push(validateEquals),ngModelCtrl.$formatters.push(validateEquals),scope.$watch(attrs.validateEquals,function(){ngModelCtrl.$setViewValue(ngModelCtrl.$viewValue)})}}}),angular.module("musicaApp").controller("MainCtrl",["$scope","$rootScope","api","$timeout",MainCtrl]),angular.module("musicaApp").controller("SignUpCtrl",["$scope","api","toastr","$timeout",SignUpCtrl]),angular.module("musicaApp").directive("emailValidate",function(){var EMAIL_REGEXP=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[A-Za-z]+\.[A-Za-z]+$/i;return{require:"ngModel",restrict:"",link:function(scope,element,attrs,ctrl){ctrl&&ctrl.$validators.email&&(ctrl.$validators.email=function(modelValue){return ctrl.$isEmpty(modelValue)||EMAIL_REGEXP.test(modelValue)})}}}),angular.module("musicaApp").directive("ngTabs",function(){return{scope:!0,restrict:"EAC",controller:function($scope){$scope.tabs={index:0,count:0},this.headIndex=0,this.bodyIndex=0,this.getTabHeadIndex=function(){return $scope.tabs.count=++this.headIndex},this.getTabBodyIndex=function(){return++this.bodyIndex}}}}).directive("ngTabHead",function(){return{scope:!1,restrict:"EAC",require:"^ngTabs",link:function(scope,element,attributes,controller){var index=controller.getTabHeadIndex(),value=attributes.ngTabHead,active=/[-*\/%^=!<>&|]/.test(value)?scope.$eval(value):!!value;scope.tabs.index=scope.tabs.index||(active?index:null),element.bind("click",function(){scope.tabs.index=index,scope.$$phase||scope.$apply()}),scope.$watch("tabs.index",function(){element.toggleClass("active",scope.tabs.index===index)})}}}).directive("ngTabBody",function(){return{scope:!1,restrict:"EAC",require:"^ngTabs",link:function(scope,element,attributes,controller){var index=controller.getTabBodyIndex();scope.$watch("tabs.index",function(){element.toggleClass(attributes.ngTabBody+" ng-show",scope.tabs.index===index)})}}}),angular.module("musicaApp").controller("LoginCtrl",["$scope","api","toastr",LoginCtrl]),angular.module("musicaApp").controller("HeaderCtrl",["$scope","$rootScope","auth","api","$state",HeaderCtrl]),angular.module("musicaApp").factory("auth",function($window,$rootScope,api){var cachedUser,storage=$window.localStorage,cachedToken="-1";return{setToken:function(token){cachedToken=token,storage.setItem("userToken",token)},getToken:function(){return"-1"==cachedToken&&(cachedToken=storage.getItem("userToken")),cachedToken},isAuthenticated:function(){return"-1"!=this.getToken()},logout:function(){storage.removeItem("userToken"),cachedToken="-1",$rootScope.$emit("update-user-token","-1")},getUser:function(token){if(cachedUser)return cachedUser;var cb=function(result){200==result.status?(cachedUser=result.data,$rootScope.$emit("user-lookup",result.data)):(storage.removeItem("userToken"),cachedToken="-1",$rootScope.$emit("update-user-token","-1"))};return api.lookup(token,cb),cb}}}),angular.module("musicaApp").controller("CdCtrl",["$scope","api","$timeout","$stateParams","$rootScope","toastr",CdCtrl]),angular.module("musicaApp").controller("GeneroCtrl",["$scope","api","toastr","$timeout","$stateParams",GeneroCtrl]),angular.module("musicaApp").controller("BuscaCtrl",["$scope","api","toastr","$timeout","$stateParams","$rootScope",BuscaCtrl]),angular.module("musicaApp").controller("EventoCtrl",["$scope","api","$stateParams","$timeout",EventoCtrl]),angular.module("musicaApp").controller("EventosCtrl",["$scope","api","toastr","$timeout","$stateParams",EventosCtrl]),angular.module("musicaApp").service("api",["ws","$upload","API_URL","blockUI",api]),angular.module("musicaApp").service("ws",["$rootScope","$http","API_URL","blockUI",ws]),angular.module("musicaApp").controller("PainelCtrl",["$scope","api",PainelCtrl]),angular.module("musicaApp").controller("NovoCDCtrl",["$scope","cd","api","auth","$state","$rootScope","$timeout",NovoCDCtrl]),angular.module("musicaApp").controller("MeusCDsCtrl",["$scope","api","auth","toastr","$timeout","$rootScope","$state",MeusCDsCtrl]),angular.module("musicaApp").controller("NovoEventoCtrl",["$scope","api","auth","$state","$rootScope","$timeout","toastr","$stateParams",NovoEventoCtrl]),angular.module("musicaApp").controller("MeusEventosCtrl",["$scope","api","auth","$state","$rootScope","$timeout","toastr",MeusEventosCtrl]),angular.module("musicaApp").controller("ConfigsCtrl",["$rootScope","$scope","api","auth","$timeout","$state","toastr","$upload",ConfigsCtrl]),angular.module("musicaApp").controller("ConfigPasswordCtrl",["$scope","api","auth","toastr","$state","$rootScope","$timeout",ConfigPasswordCtrl]),angular.module("musicaApp").controller("PerfilCtrl",["$scope","api","$stateParams","$timeout","toastr","$dialogs",PerfilCtrl]),angular.module("musicaApp").controller("SMSController",function($scope,$modalInstance){$scope.user={cell:""},$scope.cancel=function(){$modalInstance.dismiss("canceled")},$scope.save=function(){console.log("save",$scope.user.cell),$modalInstance.close($scope.user.cell)}}),angular.module("musicaApp").controller("ConfirmController",function($scope,$modalInstance){$scope.user={code:""},$scope.cancel=function(){$modalInstance.dismiss("canceled")},$scope.save=function(){console.log("save",$scope.user.code),$modalInstance.close($scope.user.code)}}),angular.module("musicaApp").controller("EditCDCtrl",["$scope","cd","$stateParams","$rootScope","auth","$state","api","$timeout",EditCDCtrl]),angular.module("musicaApp").service("cd",["$timeout","toastr","api","auth","$state","$rootScope",cd]),angular.module("musicaApp").controller("PlayerCtrl",["$scope","$rootScope","$timeout","$filter",PlayerCtrl]);